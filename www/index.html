<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Multi-Interpreter Mobile</title>
    <style>
        :root {
            --bg-color: #1e272e;
            --editor-bg: #2d3436;
            --cyan: #00d2d3;
            --red: #ff7675;
            --text: #ffffff;
            --suggestion-bg: #252d31;
            --console-bg: #111;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
        }

        #editor-container { flex: 1; position: relative; display: flex; flex-direction: column; }

        #code-editor {
            flex: 1; background: var(--editor-bg); color: var(--text);
            border: none; padding: 15px; font-family: monospace;
            font-size: 16px; outline: none; resize: none; width: 100%; box-sizing: border-box;
        }

        /* Console de Saída */
        #console-output {
            height: 120px; background: var(--console-bg);
            color: #2ecc71; padding: 10px; font-family: monospace;
            font-size: 14px; overflow-y: auto; border-top: 2px solid #333;
        }

        #suggestion-box {
            position: absolute; background: var(--suggestion-bg);
            border: 1px solid #444; border-radius: 4px;
            z-index: 100; max-height: 200px; overflow-y: auto;
            min-width: 180px; display: none;
        }

        .suggestion-item {
            padding: 10px 15px; display: flex; justify-content: space-between;
            border-bottom: 1px solid #333; cursor: pointer;
        }

        .suggestion-item .label { color: var(--cyan); font-weight: bold; }
        .suggestion-item .type { color: #888; font-size: 11px; }

        #toolbar { background: var(--bg-color); padding: 10px; border-top: 1px solid #333; }

        .shortcut-bar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; }
        .shortcut-bar button {
            background: transparent; color: var(--cyan); border: 1px solid var(--cyan);
            padding: 5px 12px; border-radius: 4px; font-weight: bold;
        }

        .action-bar { display: flex; justify-content: space-between; align-items: center; }
        button.main-btn {
            background: transparent; border: none; color: var(--cyan);
            font-weight: bold; font-size: 14px; text-transform: uppercase; cursor: pointer;
        }
        .btn-red { color: var(--red) !important; }
    </style>
</head>
<body>

    <div id="editor-container">
        <textarea id="code-editor" spellcheck="false" placeholder="language brainfuck..."></textarea>
        <div id="suggestion-box"></div>
    </div>

    <div id="console-output">Console: Aguardando execução...</div>

    <div id="toolbar">
        <div class="shortcut-bar">
            <button onclick="insertText('+')">+</button>
            <button onclick="insertText('-')">-</button>
            <button onclick="insertText('>')">&gt;</button>
            <button onclick="insertText('<')">&lt;</button>
            <button onclick="insertText('[')">[</button>
            <button onclick="insertText(']')">]</button>
            <button onclick="insertText('.')">.</button>
            <button onclick="insertText('(')">(</button>
            <button onclick="insertText(')')">)</button>
        </div>
        
        <div class="action-bar">
            <button class="main-btn" onclick="executarCodigo()">Executar</button>
            <div style="display: flex; gap: 15px;">
                <button class="main-btn btn-red" onclick="limparTudo()">Limpar</button>
                <button class="main-btn" onclick="copiarCodigo()">Copiar</button>
            </div>
        </div>
    </div>

    <script type="module">
        const editor = document.getElementById('code-editor');
        const suggestionBox = document.getElementById('suggestion-box');
        const consoleOut = document.getElementById('console-output');

        const dicionarioComandos = {
            "portugol": [
                { texto: "escreva", tipo: "Função" },
                { texto: "inteiro", tipo: "Tipo" },
                { texto: "se", tipo: "Estrutura" }
            ],
            "brainfuck": [
                { texto: "++++++++", tipo: "Snippet" }
            ]
        };

        // Atalhos globais para os botões do HTML funcionarem com type="module"
        window.insertText = (char) => {
            const start = editor.selectionStart;
            editor.setRangeText(char, start, editor.selectionEnd, 'end');
            editor.focus();
        };

        window.limparTudo = () => {
            if(confirm("Limpar tudo?")) {
                editor.value = '';
                consoleOut.innerHTML = 'Console limpo.';
                suggestionBox.style.display = 'none';
            }
        };

        window.copiarCodigo = () => {
            navigator.clipboard.writeText(editor.value);
            alert("Código copiado!");
        };

        editor.addEventListener('input', () => {
            const linhas = editor.value.split('\n');
            if (linhas[0].toLowerCase().startsWith('language ')) {
                const lang = linhas[0].replace('language ', '').trim().toLowerCase();
                checarSugestoes(lang);
            }
        });

        function checarSugestoes(lang) {
            const cursorPosition = editor.selectionStart;
            const textoAteCursor = editor.value.substring(0, cursorPosition);
            const palavras = textoAteCursor.split(/[\s\n\+\-\[\]\(\)]/);
            const ultimaPalavra = palavras[palavras.length - 1].toLowerCase();

            if (ultimaPalavra.length > 0 && dicionarioComandos[lang]) {
                const matches = dicionarioComandos[lang].filter(c => c.texto.startsWith(ultimaPalavra));
                renderizarSugestoes(matches, ultimaPalavra);
            } else {
                suggestionBox.style.display = 'none';
            }
        }

        function renderizarSugestoes(lista, termo) {
            if (lista.length === 0) { suggestionBox.style.display = 'none'; return; }
            suggestionBox.innerHTML = '';
            lista.forEach(item => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.innerHTML = `<span class="label">${item.texto}</span><span class="type">${item.tipo}</span>`;
                div.onclick = () => {
                    const inicio = editor.selectionStart - termo.length;
                    editor.setRangeText(item.texto, inicio, editor.selectionStart, 'end');
                    suggestionBox.style.display = 'none';
                    editor.focus();
                };
                suggestionBox.appendChild(div);
            });
            suggestionBox.style.display = 'block';
            suggestionBox.style.bottom = '180px'; 
            suggestionBox.style.left = '20px';
        }

        // FUNÇÃO DE EXECUÇÃO CORRIGIDA
        window.executarCodigo = async () => {
            const code = editor.value;
            const lines = code.split('\n');
            
            if (!lines[0].toLowerCase().startsWith('language ')) {
                alert("Erro: A primeira linha deve ser 'language NOME'");
                return;
            }

            const lang = lines[0].replace(/language /i, '').trim().toLowerCase();
            consoleOut.innerHTML = `Carregando interpretador: ${lang}...`;

            try {
                // Ajuste de caminho para o GitHub/Capacitor
                // Se a pasta no GitHub for 'intérpretes', use o nome exato com acento.
                // Recomendo renomear no GitHub para 'interpreters'
                const modulePath = `./intérpretes/${lang}.js`; 
                const module = await import(modulePath);
                
                consoleOut.innerHTML = `Executando...<br>`;
                module.run(code); 
            } catch (e) {
                console.error(e);
                consoleOut.innerHTML = `<span style="color:red">Erro: Interpretador '${lang}' não encontrado ou erro no arquivo.</span>`;
            }
        };
    </script>
</body>
</html>
