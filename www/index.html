<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Multi-Interpreter Mobile</title>
    <style>
        /* CSS - ESTILO DARK E INTERFACE */
        :root {
            --bg-color: #1e272e;
            --editor-bg: #2d3436;
            --cyan: #00d2d3;
            --red: #ff7675;
            --text: #ffffff;
            --suggestion-bg: #252d31;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        #editor-container {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        #code-editor {
            flex: 1;
            background: var(--editor-bg);
            color: var(--text);
            border: none;
            padding: 15px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 16px;
            outline: none;
            resize: none;
            width: 100%;
            box-sizing: border-box;
        }

        /* POP-UP DE SUGESTÕES (ESTILO PORTUGOL MOBILE) */
        #suggestion-box {
            position: absolute;
            background: var(--suggestion-bg);
            border: 1px solid #444;
            border-radius: 4px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            z-index: 100;
            max-height: 200px;
            overflow-y: auto;
            min-width: 180px;
            display: none;
        }

        .suggestion-item {
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #333;
            cursor: pointer;
        }

        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item .label { color: var(--cyan); font-weight: bold; }
        .suggestion-item .type { color: #888; font-size: 12px; }
        .suggestion-item.active { background: #3d484e; }

        /* BARRA DE FERRAMENTAS E ATALHOS */
        #toolbar {
            background: var(--bg-color);
            padding: 10px;
            border-top: 1px solid #333;
        }

        .shortcut-bar {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: none;
        }

        .shortcut-bar button {
            background: transparent;
            color: var(--cyan);
            border: 1px solid var(--cyan);
            padding: 5px 12px;
            border-radius: 4px;
            font-weight: bold;
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-group { display: flex; gap: 10px; }

        button.main-btn {
            background: transparent;
            border: none;
            color: var(--cyan);
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
            cursor: pointer;
        }

        .btn-red { color: var(--red) !important; }
    </style>
</head>
<body>

    <div id="editor-container">
        <textarea id="code-editor" spellcheck="false" placeholder="language NomeDaLinguagem..."></textarea>
        <div id="suggestion-box"></div>
    </div>

    <div id="toolbar">
        <div class="shortcut-bar">
            <button onclick="insertText('+')">+</button>
            <button onclick="insertText('-')">-</button>
            <button onclick="insertText('*')">*</button>
            <button onclick="insertText('/')">/</button>
            <button onclick="insertText('(')">(</button>
            <button onclick="insertText(')')">)</button>
            <button onclick="insertText('{')">{</button>
            <button onclick="insertText('}')">}</button>
            <button onclick="insertText('\"')">"</button>
        </div>
        
        <div class="action-bar">
            <button class="main-btn" onclick="executarCodigo()">Executar</button>
            <div class="btn-group">
                <button class="main-btn btn-red" onclick="limparTudo()">Limpar Tudo</button>
                <button class="main-btn" onclick="copiarCodigo()">Copiar</button>
            </div>
        </div>
    </div>

    <script>
        /* JAVASCRIPT - LÓGICA E ORQUESTRADOR */
        const editor = document.getElementById('code-editor');
        const suggestionBox = document.getElementById('suggestion-box');

        // Simulação de banco de dados de comandos (Você pode mover para os arquivos /interpreters/)
        const dicionarioComandos = {
            "portugol": [
                { texto: "escreva", tipo: "Função" },
                { texto: "escolha", tipo: "Sugestão" },
                { texto: "inteiro", tipo: "Tipo" },
                { texto: "logico", tipo: "Tipo" },
                { texto: "inclua", tipo: "Biblioteca" }
            ],
            "brainfuck": [
                { texto: "++++++++", tipo: "Snippet" },
                { texto: "[->+<]", tipo: "Loop" }
            ]
        };

        // Identificador de linguagem e Sugestões
        editor.addEventListener('input', () => {
            const texto = editor.value;
            const linhas = texto.split('\n');
            const primeiraLinha = linhas[0].toLowerCase();
            
            if (primeiraLinha.startsWith('language ')) {
                const lang = primeiraLinha.replace('language ', '').trim();
                checarSugestoes(lang);
            }
        });

        function checarSugestoes(lang) {
            const texto = editor.value;
            const cursorPosition = editor.selectionStart;
            const palavras = texto.substring(0, cursorPosition).split(/\s/);
            const ultimaPalavra = palavras[palavras.length - 1].toLowerCase();

            if (ultimaPalavra.length > 0 && dicionarioComandos[lang]) {
                const matches = dicionarioComandos[lang].filter(c => c.texto.startsWith(ultimaPalavra));
                renderizarSugestoes(matches, ultimaPalavra);
            } else {
                suggestionBox.style.display = 'none';
            }
        }

        function renderizarSugestoes(lista, termo) {
            if (lista.length === 0) {
                suggestionBox.style.display = 'none';
                return;
            }

            suggestionBox.innerHTML = '';
            lista.forEach(item => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                // Destaca em verde a parte digitada
                const textoFormatado = item.texto.replace(termo, `<span style="color:#2ecc71">${termo}</span>`);
                div.innerHTML = `<span class="label">${textoFormatado}</span><span class="type">${item.tipo}</span>`;
                div.onclick = () => completarTexto(item.texto, termo);
                suggestionBox.appendChild(div);
            });

            suggestionBox.style.display = 'block';
            // Posiciona o box acima do teclado (simplificado para mobile)
            suggestionBox.style.bottom = '80px'; 
            suggestionBox.style.left = '15px';
        }

        function completarTexto(completo, termo) {
            const inicio = editor.selectionStart - termo.length;
            const fim = editor.selectionStart;
            editor.setRangeText(completo, inicio, fim, 'end');
            suggestionBox.style.display = 'none';
            editor.focus();
        }

        // Ações dos Botões
        function insertText(char) {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            editor.setRangeText(char, start, end, 'end');
            editor.focus();
        }

        function limparTudo() {
            if(confirm("Deseja limpar todo o código?")) {
                editor.value = '';
                suggestionBox.style.display = 'none';
            }
        }

        async function executarCodigo() {
            const code = editor.value;
            const lines = code.split('\n');
            if (!lines[0].toLowerCase().startsWith('language ')) {
                alert("Erro: Use 'language NOME' na primeira linha!");
                return;
            }
            const lang = lines[0].replace(/language /i, '').trim().toLowerCase();
            
            try {
                // Tenta importar o arquivo da pasta /interpreters/
                const module = await import(`./interpreters/${lang}.js`);
                module.run(code);
            } catch (e) {
                alert(`Erro: Interpretador de '${lang}' não encontrado em /interpreters/`);
            }
        }
    </script>
</body>
</html>
